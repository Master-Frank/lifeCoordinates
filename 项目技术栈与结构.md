# 项目技术栈与结构分析

## 项目概览
- 采用 npm workspaces 的多包结构，核心能力沉淀在共享包，前后端应用分别在 apps 下。
- 主要由前端 Web 应用、后端 API 服务、核心业务库、独立的 Tarot 交互应用组成。

## 技术栈
### 语言与构建
- TypeScript（全仓库）
- Vite（前端构建与开发）
- npm workspaces（多包管理）

### 前端
- React 18（apps/web）
- Vite + @vitejs/plugin-react（apps/web）
- ECharts（K 线图可视化）
- china-area-data（中国行政区数据）
- 纯 CSS（src/styles.css）

### 后端
- Fastify（HTTP 服务框架）
- @fastify/cors（跨域）
- zod（数据校验）
- dotenv（环境变量加载）

### 业务核心库
- @life-coordinates/core（共享算法与类型）
- lunar-javascript（农历/四柱相关计算）

### 独立应用（Tarot）
- React 19
- @react-three/fiber / @react-three/drei / three（3D 渲染）
- @mediapipe/tasks-vision（手部识别）
- 构建产物输出到 apps/web/public/tarot

### 代码规范
- ESLint（eslint.config.js）
- TypeScript 严格模式（tsconfig.base.json）

## 项目结构
```
lifeCoordinates/
├─ apps/
│  ├─ api/                # 后端 API 服务
│  │  ├─ src/server.ts     # Fastify 入口
│  │  └─ data/shares.json  # 分享数据存储
│  └─ web/                # 前端 Web 应用
│     ├─ src/
│     │  ├─ components/    # UI 组件
│     │  ├─ lib/           # API/格式化/存储工具
│     │  ├─ pages/         # 分步页面
│     │  └─ types/         # 类型声明
│     ├─ public/           # 静态资源（含 tarot 构建产物）
│     └─ vite.config.ts    # 开发代理与端口
├─ packages/
│  └─ core/                # 共享业务与算法库
│     └─ src/              # birth/paipan/kline 等核心逻辑
├─ apps/tarot/             # 独立 Tarot 交互应用（Vite + 3D）
├─ deploy/                 # 部署/本地验证脚本
├─ eslint.config.js        # ESLint 配置
├─ tsconfig.base.json      # TS 基础配置
└─ package.json            # 工作区与全局脚本
```

## 关键应用说明
### apps/web
- Vite 开发端口 5173，并代理 /api 到本地 8787。
- 页面采用 hash 路由，包含输入、确认、结果与 tarot 页面。
- 图表与核心算法来自 @life-coordinates/core。

### apps/api
- Fastify 服务入口为 src/server.ts。
- 提供地理信息查询、排盘与 K 线生成相关能力。
- 数据默认以 JSON 文件形式持久化在 data/shares.json。

### packages/core
- 统一封装 birth/paipan/kline 等核心计算逻辑。
- 由前端与后端共同依赖使用。

### apps/tarot
- Vite 构建输出到 apps/web/public/tarot。
- 运行端口 3000，默认对外监听 0.0.0.0。

## 脚本与构建
- 根级 build/lint/typecheck 统一调度 workspaces。
- apps/api 使用 tsx watch 开发，tsc 构建后 node 运行。
- apps/web 先 typecheck 再打包。
- deploy 目录包含 docker-compose 部署脚本与 Windows 本地验证脚本。
